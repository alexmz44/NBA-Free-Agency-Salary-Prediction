---
title: "Phoenix Suns Project"
author: "Alexander Martinez"
date: "6/20/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
The the problem to address is that we are looking to predict the open market price of Free Agents this offseason. I began by getting the contract information of each player from Spotrac.com. 
```{r}
#retrieve appropriate packages
library(rvest)
library(stringr)
library(tidyverse)

#read in the data by scraping it from spotrac.com

faurl <- "https://www.spotrac.com/nba/free-agents/"
webpage <- read_html(faurl)
fatable <- html_nodes(webpage,"table")
fa <- html_table(fatable, fill = T, header = T)[[1]]

#transform into a data frame
fa_df <- as.data.frame(fa)
head(fa_df)
dim(fa_df)

#Erase the first word of a column; oddly enough, it was separated by 4 spaces.
fa_df$`Player (194)` <- word(fa_df$`Player (194)`, 2, sep = "    ")
head(fa_df)

# rename the player column
fa_df <- fa_df %>%
  rename(Player = `Player (194)`)

```

Now I need to get scrape average stats from another website and match the free agent names to those stats
```{r}
# Find css selector
css_selector <- "#div_per_game_stats"
statpage <- "https://www.basketball-reference.com/leagues/NBA_2022_per_game.html"

#use pipelines to get the tables
nba_stats <- statpage %>%
  read_html()%>%
  html_element(css = css_selector) %>%
  html_table()
# remove rank column
nba_stats <- nba_stats %>%
  select(-Rk)

tail(nba_stats)
# some of the names do not match exactly, we must go in and manually input them, we can check which names like so
fa_df %>% select(Player) %>% anti_join(nba_stats)

# Using recode to change all of the names that do not match
fa_df <- fa_df %>%
  mutate(Player = recode(Player, "Bruce Brown Jr." = "Bruce Brown",
                         "Patrick Mills" = "Patty Mills",
                         "Mohamed Bamba" = "Mo Bamba",
                         "Louis Williams" = "Lou Williams",
                         "Sviatoslav Mykhailiuk" = "Svi Mykhailiuk",
                         "Jae'Sean Tate" = "Jae'Sean Tate",
                         "Nicolas Claxton" = "Nic Claxton",
                         "Danuel House" = "Danuel House Jr.",
                         "Ishmail Wainright" = "Ish Wainright",
                         "R.J. Nembhard" = "RJ Nembhard Jr.",
                         "Lindell Wiggington" = "Lindell Wigginton"
                         ))
# I need to add a row for the all the players who didnt play. I am going to impute their average stats from last year's season
css_selector1 <- "#per_game > tfoot > tr:nth-child(1)"
warrenpage <- "https://www.basketball-reference.com/players/w/warretj01.html"

nba_stats[nrow(nba_stats) + 1,] <- c()
# merge the tables based on player name
new_df <- merge(fa_df, nba_stats, by = "Player")
dim(new_df)
head(new_df)


```

After this, we begin cleaning the data, and we start the process of selecting our variables.
```{r}
# clean up the table 


# there are players that were on multiple teams last season, and "tot" represents total
# this gets all of the distinct players' names that have the "TOT" 
tot <- new_df %>%
  filter(Tm == "TOT") %>%
  select(Player)%>%
  distinct()

# Use the %in% operator to extract the rows of the data frame with those players' names
# use that to create a data frame that extracts the rows of within those group of players that we do not want
df <- new_df[new_df$Player %in% tot$Player,] %>%
  filter(Tm != "TOT")
head(df)

# antijoin with the rows we do not want, this takes those rows out
df2 <- new_df %>% anti_join(df)
df2


```

